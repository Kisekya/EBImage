
R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
Copyright (C) 2012 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ## cat tests/test.R | R --vanilla &>tests/test.Rout.save
> library(EBImage)
> 
> ## returns a hashcode given an object
> hash=function(x) {
+   if (is.list(x)) hash(sapply(x,hash))
+   else {
+     xd=as.numeric(x)
+     xd=xd[!is.nan(xd)]
+     sum(xd*(1:length(xd)))
+   }
+ }
> 
> ## try to evaluate fun(x,...) 
> check=function(fun,x,...) {
+   passed = TRUE
+   
+   cat('checking \'',fun,'\' ... ',sep='')
+   y=try(do.call(fun,c(list(x),list(...))),silent=T)
+   if (class(y)=='try-error' || ( is.Image(y) && !validObject(y)) ) {
+     y=NULL
+     passed=F
+   }
+   
+   if (passed) cat('OK (hash=',hash(y),')\n',sep='') 
+   else cat('FAILED\n')
+    
+   y
+ }
> 
> ## test a subset of EBImage functions on x
> testEBImageFunctions=function(x) {  
+   ## Image, is.image, Ops, as.Image
+   ## imageData, imageData, colorMode, colorMode<-, print
+   ## [, getNumberOfFrames
+   cat('new test (hash=',hash(x),')\n',sep='')
+   if (class(x)=='Image') check('print',x)
+   y=Image(x,colormode=Color)
+   a=is.Image(y)
+   y=check('>',x,0.5)
+   y=check('+',x,y)
+   y=check('/',x,2)
+   z=as.Image(imageData(y))
+   imageData(z)=y
+   colorMode(z)=Grayscale
+   pat=as.list(rep(T,length(dim(x))))
+   pat[[1]]=1:100
+   pat[[2]]=1:100
+   b=check('getNumberOfFrames',y,type='render')
+   y=do.call('[',c(list(x),pat))
+ 
+   ## display
+   if (interactive()) check('display',x,main='x')
+   check('writeImage',x,'test.png')
+ 
+   ## resize, resample, rotate, flip, flop, translate
+   y=check('resize',x,277,139)
+   y=check('rotate',x,20)
+   y=check('flip',x)
+   y=check('flop',x)
+   y=check('translate',x,rep(1,2*getNumberOfFrames(x,'total')))
+ 
+   ## thresh
+   y=check('thresh',x)
+   
+   ## median, hist
+   if (mode(x)!='logical') b=check('median',x)
+   if (mode(x)!='logical' & interactive()) check('hist',x) 
+ 
+   ## blur, gblur, normalize
+   y=check('gblur',x,r=10,s=5)
+   y=check('normalize',x)
+ 
+   ## filter2
+   z=matrix(1,nc=5,nr=5)
+   z[3,3]=-24
+   y=check('filter2',x,z)
+ 
+   ## erode, dilate, opening, closing, distmap, watershed
+   w=x>0.5
+   y=check('erode',w)
+   y=check('dilate',w)
+   y=check('opening',w)
+   y=check('closing',w)
+   y=check('distmap',w)
+   ws=check('watershed', y)
+   y=check('floodFill', w, c(10,10), 0.5)
+   y=check('fillHull', w)
+   y=check('bwlabel', w)
+   
+   ## rgbImage, channel
+   if (colorMode(x)==Grayscale) {
+     y=rgbImage(x,flip(x),flop(x))
+     w=check('channel',x,'asblue')
+     w=check('channel',x,'rgb')
+   } else y=x
+   w=check('channel',y,'gray')
+   w=check('channel',y,'green')
+   w=check('channel',y,'x11')
+   
+   ## combine, tile, untile
+   y=check('combine',x,x,x)
+   y=check('tile',y,nx=2)
+   y=check('untile',y,c(2,2))
+ 
+   ## hullFeatures, rmObjects, reenumerate, getFeatures (contains hullFeatures, edgeFeatures, haralickFeatures, zernikeMoments, moments)
+   ## paintObjects
+   w=ws
+   w[w@.Data==1]=2
+   w[w@.Data==3]=2117
+   y=check('reenumerate',w)
+   w=ws
+   hf=check('hullFeatures', w)
+   if (!is.list(hf)) hf=list(hf)
+   rmindex = lapply(hf, function(c) which(c[,'g.s']<6))
+   w=check('rmObjects', w, rmindex)
+   y=check('getFeatures', w, x)
+   if (colorMode(w)==Color) w = channel(w, 'red')
+   y=check('paintObjects', w, x)
+   cat('\n')
+ }
> 
> ## Testing procedure
> lena=readImage(system.file("images","lena.png", package="EBImage"))
> lenacolor=readImage(system.file("images","lena-color.png",package="EBImage"))
> 
> ## Resizing images, for speeding up testing
> lena=resize(lena, 128, 128)
> lenacolor=resize(lenacolor, 128, 128)
> 
> ## Image - Grayscale - 1 image  - 2 dim - numeric
> testEBImageFunctions(lena)
new test (hash=50335501)
checking 'print' ... Image
  colormode: Grayscale 
  storage.mode: double 
  dim: 128 128 
  nb.total.frames: 1 
  nb.render.frames: 1 

imageData(object)[1:5,1:6]:
          [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
[1,] 0.5372549 0.5372549 0.5058824 0.5137255 0.5058824 0.5176471
[2,] 0.5411765 0.5411765 0.5254902 0.5137255 0.5137255 0.5019608
[3,] 0.5490196 0.5490196 0.5450980 0.5333333 0.5019608 0.5176471
[4,] 0.5098039 0.5098039 0.5333333 0.5058824 0.5176471 0.5176471
[5,] 0.5254902 0.5254902 0.5019608 0.5098039 0.4901961 0.5137255

OK (hash=0)
checking '>' ... OK (hash=39171428)
checking '+' ... OK (hash=89506929)
checking '/' ... OK (hash=25167750)
checking 'getNumberOfFrames' ... OK (hash=1)
checking 'writeImage' ... OK (hash=NA)
checking 'resize' ... OK (hash=277296103)
checking 'rotate' ... OK (hash=45925639)
checking 'flip' ... OK (hash=53915623)
checking 'flop' ... OK (hash=50278455)
checking 'translate' ... OK (hash=49327041)
checking 'thresh' ... OK (hash=58099799)
checking 'median' ... OK (hash=0.3803922)
checking 'gblur' ... FAILED
checking 'normalize' ... OK (hash=54530153)
checking 'filter2' ... OK (hash=2104930)
checking 'erode' ... OK (hash=19874718)
checking 'dilate' ... OK (hash=65605139)
checking 'opening' ... OK (hash=32358128)
checking 'closing' ... OK (hash=43302337)
checking 'distmap' ... OK (hash=105751790)
checking 'watershed' ... OK (hash=350934323)
checking 'floodFill' ... OK (hash=36055081)
checking 'fillHull' ... OK (hash=39615366)
checking 'bwlabel' ... OK (hash=1992660245)
checking 'channel' ... OK (hash=258710939)
checking 'channel' ... OK (hash=463569659)
checking 'channel' ... OK (hash=51509860)
checking 'channel' ... OK (hash=53915623)
checking 'channel' ... OK (hash=NA)
checking 'combine' ... OK (hash=463569659)
checking 'tile' ... OK (hash=1166842895)
checking 'untile' ... OK (hash=1163613325)
checking 'reenumerate' ... OK (hash=718366481)
checking 'hullFeatures' ... OK (hash=6524854)
checking 'rmObjects' ... OK (hash=284644560)
checking 'getFeatures' ... OK (hash=141850638)
checking 'paintObjects' ... OK (hash=42775865)

Warning messages:
1: In hash(y) : NAs introduced by coercion
2: In hash(y) : NAs introduced by coercion
> 
> ## Image - Grayscale - 1 image  - 2 dim - logical
> x=lena>0.5
> testEBImageFunctions(x)
new test (hash=39171428)
checking 'print' ... Image
  colormode: Grayscale 
  storage.mode: logical 
  dim: 128 128 
  nb.total.frames: 1 
  nb.render.frames: 1 

imageData(object)[1:5,1:6]:
     [,1] [,2] [,3] [,4]  [,5] [,6]
[1,] TRUE TRUE TRUE TRUE  TRUE TRUE
[2,] TRUE TRUE TRUE TRUE  TRUE TRUE
[3,] TRUE TRUE TRUE TRUE  TRUE TRUE
[4,] TRUE TRUE TRUE TRUE  TRUE TRUE
[5,] TRUE TRUE TRUE TRUE FALSE TRUE

OK (hash=0)
checking '>' ... OK (hash=39171428)
checking '+' ... OK (hash=78342856)
checking '/' ... OK (hash=19585714)
checking 'getNumberOfFrames' ... OK (hash=1)
checking 'writeImage' ... OK (hash=NA)
checking 'resize' ... OK (hash=215965530)
checking 'rotate' ... OK (hash=36960233)
checking 'flip' ... OK (hash=42791268)
checking 'flop' ... OK (hash=39068192)
checking 'translate' ... OK (hash=38504713)
checking 'thresh' ... OK (hash=35967569)
checking 'gblur' ... FAILED
checking 'normalize' ... OK (hash=39171428)
checking 'filter2' ... OK (hash=1882880)
checking 'erode' ... OK (hash=19874718)
checking 'dilate' ... OK (hash=65605139)
checking 'opening' ... OK (hash=32358128)
checking 'closing' ... OK (hash=43302337)
checking 'distmap' ... OK (hash=105751790)
checking 'watershed' ... OK (hash=350934323)
checking 'floodFill' ... OK (hash=36055081)
checking 'fillHull' ... OK (hash=39615366)
checking 'bwlabel' ... OK (hash=1992660245)
checking 'channel' ... OK (hash=202880356)
checking 'channel' ... OK (hash=363077676)
checking 'channel' ... OK (hash=40343629)
checking 'channel' ... OK (hash=42791268)
checking 'channel' ... OK (hash=NA)
checking 'combine' ... OK (hash=363077676)
checking 'tile' ... OK (hash=1052490457)
checking 'untile' ... OK (hash=1063121342)
checking 'reenumerate' ... OK (hash=718366481)
checking 'hullFeatures' ... OK (hash=6524854)
checking 'rmObjects' ... OK (hash=284644560)
checking 'getFeatures' ... OK (hash=314221321)
checking 'paintObjects' ... OK (hash=26467155)

Warning messages:
1: In hash(y) : NAs introduced by coercion
2: In hash(y) : NAs introduced by coercion
> 
> ## Image - Color - 1 image  - 3 dim - numeric
> testEBImageFunctions(lenacolor)
new test (hash=522787501)
checking 'print' ... Image
  colormode: Color 
  storage.mode: double 
  dim: 128 128 3 
  nb.total.frames: 3 
  nb.render.frames: 1 

imageData(object)[1:5,1:6,1]:
          [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
[1,] 0.8862745 0.8862745 0.8823529 0.8901961 0.8941176 0.8784314
[2,] 0.8862745 0.8862745 0.8823529 0.8901961 0.8823529 0.8823529
[3,] 0.8901961 0.8901961 0.8862745 0.8784314 0.8823529 0.8823529
[4,] 0.8745098 0.8745098 0.8745098 0.8941176 0.8823529 0.8941176
[5,] 0.8666667 0.8666667 0.8901961 0.8862745 0.8823529 0.9058824

OK (hash=0)
checking '>' ... OK (hash=372312531)
checking '+' ... OK (hash=895100032)
checking '/' ... OK (hash=261393751)
checking 'getNumberOfFrames' ... OK (hash=1)
checking 'writeImage' ... OK (hash=NA)
checking 'resize' ... OK (hash=2880089815)
checking 'rotate' ... OK (hash=466319655)
checking 'flip' ... OK (hash=533942992)
checking 'flop' ... OK (hash=522671866)
checking 'translate' ... OK (hash=514169866)
checking 'thresh' ... OK (hash=502612080)
checking 'median' ... OK (hash=0.4666667)
checking 'gblur' ... FAILED
checking 'normalize' ... OK (hash=559369020)
checking 'filter2' ... OK (hash=6139264)
checking 'erode' ... OK (hash=199682385)
checking 'dilate' ... OK (hash=625914875)
checking 'opening' ... OK (hash=288039479)
checking 'closing' ... OK (hash=428956439)
checking 'distmap' ... OK (hash=1477468218)
checking 'watershed' ... OK (hash=3742266665)
checking 'floodFill' ... OK (hash=567708450)
checking 'fillHull' ... OK (hash=392578365)
checking 'bwlabel' ... OK (hash=22609023965)
checking 'channel' ... OK (hash=65626043)
checking 'channel' ... OK (hash=50335501)
checking 'channel' ... OK (hash=NA)
checking 'combine' ... OK (hash=5211305197)
checking 'tile' ... OK (hash=10695516194)
checking 'untile' ... OK (hash=11511661564)
checking 'reenumerate' ... OK (hash=11261019240)
checking 'hullFeatures' ... OK (hash=49754029)
checking 'rmObjects' ... OK (hash=2473184949)
checking 'getFeatures' ... OK (hash=1000316559)
checking 'paintObjects' ... OK (hash=479640327)

Warning messages:
1: In hash(y) : NAs introduced by coercion
2: In hash(y) : NAs introduced by coercion
> 
> ## Image - Color - 2 images - 4 dim - numeric
> x=combine(lenacolor, lenacolor)
> testEBImageFunctions(x)
new test (hash=2259889233)
checking 'print' ... Image
  colormode: Color 
  storage.mode: double 
  dim: 128 128 3 2 
  nb.total.frames: 6 
  nb.render.frames: 2 

imageData(object)[1:5,1:6,1,1]:
          [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
[1,] 0.8862745 0.8862745 0.8823529 0.8901961 0.8941176 0.8784314
[2,] 0.8862745 0.8862745 0.8823529 0.8901961 0.8823529 0.8823529
[3,] 0.8901961 0.8901961 0.8862745 0.8784314 0.8823529 0.8823529
[4,] 0.8745098 0.8745098 0.8745098 0.8941176 0.8823529 0.8941176
[5,] 0.8666667 0.8666667 0.8901961 0.8862745 0.8823529 0.9058824

OK (hash=0)
checking '>' ... OK (hash=1814025126)
checking '+' ... OK (hash=4073914359)
checking '/' ... OK (hash=1129944617)
checking 'getNumberOfFrames' ... OK (hash=2)
checking 'writeImage' ... OK (hash=NA)
checking 'resize' ... OK (hash=12450507153)
checking 'rotate' ... OK (hash=2006935518)
checking 'flip' ... OK (hash=2282200216)
checking 'flop' ... OK (hash=2259657963)
checking 'translate' ... OK (hash=2224982373)
checking 'thresh' ... OK (hash=2035056864)
checking 'median' ... OK (hash=0.4666667)
checking 'gblur' ... FAILED
checking 'normalize' ... OK (hash=2330989943)
checking 'filter2' ... OK (hash=12278528)
checking 'erode' ... OK (hash=1140724386)
checking 'dilate' ... OK (hash=2749982710)
checking 'opening' ... OK (hash=1510212718)
checking 'closing' ... OK (hash=2035496494)
checking 'distmap' ... OK (hash=12461113647)
checking 'watershed' ... OK (hash=14181100114)
checking 'floodFill' ... OK (hash=2174785091)
checking 'fillHull' ... OK (hash=1922140794)
checking 'bwlabel' ... OK (hash=74249136058)
checking 'channel' ... OK (hash=266175890)
checking 'channel' ... OK (hash=204858720)
checking 'channel' ... OK (hash=NA)
checking 'combine' ... OK (hash=21351438472)
checking 'tile' ... OK (hash=20128251731)
checking 'untile' ... OK (hash=21045916887)
checking 'reenumerate' ... OK (hash=42197534928)
checking 'hullFeatures' ... OK (hash=165465537)
checking 'rmObjects' ... OK (hash=9958792554)
checking 'getFeatures' ... OK (hash=3310273425)
checking 'paintObjects' ... OK (hash=2132035037)

Warning messages:
1: In hash(y) : NAs introduced by coercion
2: In hash(y) : NAs introduced by coercion
> 
> ## matrix - 2 images - 3 dim - numeric
> x=imageData(lena)
> x=combine(x, x)
> testEBImageFunctions(x)
new test (hash=204858720)
checking '>' ... OK (hash=160197320)
checking '+' ... OK (hash=365056040)
checking '/' ... OK (hash=102429360)
checking 'getNumberOfFrames' ... OK (hash=2)
checking 'writeImage' ... OK (hash=NA)
checking 'resize' ... OK (hash=1128761234)
checking 'rotate' ... OK (hash=184305774)
checking 'flip' ... OK (hash=212018966)
checking 'flop' ... OK (hash=204744629)
checking 'translate' ... OK (hash=201415687)
checking 'thresh' ... OK (hash=231755950)
checking 'median' ... OK (hash=0.3803922)
checking 'gblur' ... FAILED
checking 'normalize' ... OK (hash=222053999)
checking 'filter2' ... OK (hash=4209860)
checking 'erode' ... OK (hash=82380604)
checking 'dilate' ... OK (hash=262478886)
checking 'opening' ... OK (hash=133922272)
checking 'closing' ... OK (hash=176552834)
checking 'distmap' ... OK (hash=435332184)
checking 'watershed' ... OK (hash=1386572390)
checking 'floodFill' ... OK (hash=146993234)
checking 'fillHull' ... OK (hash=162592524)
checking 'bwlabel' ... OK (hash=6809791018)
checking 'channel' ... OK (hash=829985036)
checking 'channel' ... OK (hash=1864828792)
checking 'channel' ... OK (hash=207207439)
checking 'channel' ... OK (hash=212018966)
checking 'channel' ... OK (hash=NA)
checking 'combine' ... OK (hash=1864828792)
checking 'tile' ... OK (hash=1959673274)
checking 'untile' ... OK (hash=1861083829)
checking 'reenumerate' ... OK (hash=3691187746)
checking 'hullFeatures' ... OK (hash=19574563)
checking 'rmObjects' ... OK (hash=1141074336)
checking 'getFeatures' ... OK (hash=425551915)
checking 'paintObjects' ... OK (hash=174324161)

Warning messages:
1: In hash(y) : NAs introduced by coercion
2: In hash(y) : NAs introduced by coercion
> 
